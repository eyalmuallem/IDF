<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<title>×“×©×‘×•×¨×“ ×¦×™×•×“</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* =========================
   ğŸ¨ DESIGN SYSTEM
========================= */
:root{
  --bg:#f3f4f6;
  --card:#ffffff;
  --primary:#1f2937;
  --secondary:#374151;
  --accent:#2563eb;
  --accent-dark:#1e40af;
  --border:#e5e7eb;
}

/* =========================
   ğŸŒ GLOBAL
========================= */
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: Arial, sans-serif;
  direction: rtl;
  background: #f3f4f6; /* ×¦×‘×¢ ××—×™×“ */
  color: #111827;
}
.page {
  min-height: 100vh;
  background: linear-gradient(180deg, #f3f4f6 0%, #eef2f7 100%);
  padding-bottom: 40px;
}




/* =========================
   ğŸ§­ HEADER
========================= */
.header {
  background: var(--primary);
  color: white;
  padding: 16px 24px;
  display:flex;
  justify-content: space-between;
  align-items:center;
  box-shadow: 0 8px 24px rgba(0,0,0,0.12);
  position: sticky;
  top: 0;
  z-index: 10;
}

.header h1 {
  margin:0;
  font-size:20px;
  font-weight:600;
}

.datetime {
  font-size:14px;
  opacity:0.85;
  font-variant-numeric: tabular-nums;
}

/* =========================
   ğŸ“¦ PAGE LAYOUT
========================= */
.container {
  padding: 24px 32px;
  width: 100%;
}

/* =========================
   ğŸ› CONTROLS
========================= */
.controls {
  background: rgba(255,255,255,0.94);
  border:1px solid var(--border);
  border-radius:12px;
  padding:16px;
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:20px;
  box-shadow:0 4px 14px rgba(0,0,0,0.06);
}

.controls label {
  font-size:14px;
  color:var(--secondary);
}

.controls input {
  padding:7px 10px;
  border:1px solid var(--border);
  border-radius:8px;
  background:#fff;
}

/* =========================
   ğŸ”˜ BUTTONS
========================= */
.controls button {
  border-radius:8px;
  padding:8px 16px;
  cursor:pointer;
  font-size:14px;
  border:none;
  transition: all .2s ease;
}

/* Primary */
.controls button.primary {
  background: linear-gradient(135deg, var(--accent), var(--accent-dark));
  color:#fff;
  box-shadow: 0 2px 4px rgba(37,99,235,0.2);
}

.controls button.primary:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 14px rgba(37,99,235,.35);
}

/* Secondary */
.controls button.secondary {
  background: #f3f4f6;
  color: #374151;
  border: 1px solid var(--border);
}

.controls button.secondary:hover {
  background: #e5e7eb;
}

/* Outline */
.controls button.outline {
  background: transparent;
  color: var(--secondary);
  border: 1px dashed var(--border);
}

.controls button.outline:hover {
  background:#eef2f7;
}

/* =========================
   ğŸ“Š TABLE CARD
========================= */
.table-card {
  background: rgba(255,255,255,0.92);
  backdrop-filter: blur(6px);
  border-radius:12px;
  border:1px solid var(--border);
  box-shadow:0 4px 16px rgba(0,0,0,0.06);
  overflow:hidden;
}

/* =========================
   ğŸ“‹ TABLE
========================= */
table {
  width:100%;
  border-collapse: collapse;
}

th, td {
  padding:12px;
  border-bottom:1px solid #eef2f7;
  text-align:center;
  font-size:14px;
}

thead tr {
  background: linear-gradient(180deg, #1f2937, #111827);
}

th {
  color: #e5e7eb;
  font-weight: 600;
  font-size: 13px;
  letter-spacing: .06em;
  text-transform: uppercase;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}


tr:hover {
  background:#f8fafc;
}

/* =========================
   âœ… STATUS COLORS
========================= */
/* ===== STATUS ROW BACKGROUND ===== */
tr.IN {
  background: linear-gradient(
    90deg,
    rgba(16,185,129,0.10),
    rgba(16,185,129,0.04)
  );
}

tr.OUT {
  background: linear-gradient(
    90deg,
    rgba(239,68,68,0.12),
    rgba(239,68,68,0.05)
  );
}

/* ×—×™×–×•×§ ×”×¡×˜×˜×•×¡ ×¢×¦××• */
tr.IN td:nth-child(2),
tr.OUT td:nth-child(2) {
  color: #111827; /* ×©×—×•×¨ ××—×™×“ */
  font-weight: 500;
}


/* hover ×¢×“×™×Ÿ ×©×œ× ×©×•×‘×¨ ××ª ×”×¦×‘×¢ */
tr.IN:hover,
tr.OUT:hover {
  filter: brightness(0.97);
}


/* =========================
   ğŸ“‰ STATS ANIMATION
========================= */
#statsContainer {
  animation: fadeUp .25s ease;
}

@keyframes fadeUp {
  from {
    opacity:0;
    transform: translateY(6px);
  }
  to {
    opacity:1;
    transform: translateY(0);
  }
}

/* =========================
   ğŸ§¾ FOOTER
========================= */
.footer-note {
  margin-top:10px;
  font-size:12px;
  color:#6b7280;
  opacity:.7;
}

/* ×× ×™×¢×ª hover/tap ×¢×œ ×›×•×ª×¨×ª ×”×˜×‘×œ×” (×‘×¢×™×§×¨ iOS) */
thead tr:hover {
  background: linear-gradient(180deg, #1f2937, #111827) !important;
}


</style>
</head>

<body>
    <div class="page">


<!-- ===== Header ===== -->
<div class="header">
  <h1>ğŸ“Š ×“×©×‘×•×¨×“ ×‘×§×¨×” â€“ ×¦×™×•×“</h1>
  <div class="datetime" id="datetime"></div>
</div>




  <!-- ===== Controls ===== -->
  <div class="controls">
  <label>×ª××¨×™×š ×œ×¦×¤×™×™×”:</label>
  <input type="date" id="viewDate">
  <button class="primary" onclick="loadData()">×¦×¤×”</button>
<button class="secondary" onclick="loadData(showOnlyOut)">×¨×¢× ×Ÿ</button>
<button class="outline" onclick="toggleStats()" id="statsBtn">×¡×˜×˜×™×¡×˜×™×§×•×ª</button>
<button class="outline" onclick="toggleOutOnly()" id="outBtn">
  ×”×¦×’ ××™×¨×•×¢×™× ×©×œ× ×—×–×¨×•
</button>

</div>



  <!-- ===== Table ===== -->
  <div class="table-card">
    <table id="tbl">
      <thead>
        <tr>
          <th>××¡×³ ××¡××š</th>
          <th>×¡×˜×˜×•×¡</th>
          <th>×©× ×”××™×¨×•×¢</th>
          <th>×©× ×”×—×•×ª×</th>
          <th>×ª××¨×™×š</th>
          <th>×©×¢×”</th> 
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="footer-note">
    × ×ª×•× ×™× ×‘×–××Ÿ ×××ª  
  </div>
   <div id="statsContainer" class="table-card" style="margin-top:20px; display:none; padding:16px;">

  <div style="display:flex; gap:10px; align-items:center; margin-bottom:12px;">
    <label>×Ö¾</label>
    <input type="date" id="statsFrom">

    <label>×¢×“</label>
    <input type="date" id="statsTo">

    <button class="secondary" onclick="updateStatsRange()">×”×¦×’</button>
  </div>
  <button class="outline" onclick="toggleTrend()">×§×• ××’××”</button>


  <canvas id="weeklyChart" height="60"></canvas>
</div>


</div>

<script>
  let showOnlyOut = false;

const GID = "0";
const URL = `https://docs.google.com/spreadsheets/d/1-FwT_TEBWPH-tEk1N3bi88S-9TukQ3iPJMl6l0ikDCI/gviz/tq?tqx=out:json&gid=${GID}`;

// dd/mm/yyyy â†’ yyyy-mm-dd
function normalizeDate(ddmmyyyy) {
  if (!ddmmyyyy || !ddmmyyyy.includes("/")) return null;
  const [dd, mm, yyyy] = ddmmyyyy.split("/");
  return `${yyyy}-${mm.padStart(2,"0")}-${dd.padStart(2,"0")}`;
}

let weeklyChart;
let showTrend = false;


function calculateTrend(data, window = 3) {
  return data.map((_, i) => {
    const start = Math.max(0, i - window + 1);
    const slice = data.slice(start, i + 1);
    const avg = slice.reduce((a,b)=>a+b,0) / slice.length;
    return Number(avg.toFixed(2));
  });
}



function updateWeeklyChart(rows) {
  const fromInput = document.getElementById("statsFrom")?.value;
const toInput   = document.getElementById("statsTo")?.value;

const fromDate = fromInput ? new Date(fromInput) : null;
const toDate   = toInput   ? new Date(toInput)   : null;

  const counts = {};
  const labels = [];

    // ×‘×¨×™×¨×ª ××—×“×œ: 7 ×™××™× ××—×¨×•× ×™× ×× ×œ× ×‘×—×¨×• ×˜×•×•×—
  const end = toDate ? new Date(toDate) : new Date();
  const start = fromDate ? new Date(fromDate) : new Date(end);

  if (!fromDate) start.setDate(end.getDate() - 6);

  // ×œ× ×¨××œ ×œ×©×¢×” 00:00 ×›×“×™ ×©×”×©×•×•××•×ª ×™×¢×‘×“×• ×—×œ×§
  start.setHours(0,0,0,0);
  end.setHours(0,0,0,0);

  // ×‘×•× ×™× counts + labels ×œ×›×œ ×™×•× ×‘×˜×•×•×—
  for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
   const key =
  d.getFullYear() + "-" +
  String(d.getMonth() + 1).padStart(2, "0") + "-" +
  String(d.getDate()).padStart(2, "0");

    counts[key] = 0;

    labels.push(
      d.getDate().toString().padStart(2,"0") + "/" +
      (d.getMonth()+1).toString().padStart(2,"0")
    );
  }


  rows.slice(1).forEach(r => {
  const status = r.c?.[1]?.v;
  if (status !== "IN" && status !== "OUT") return;

  const dateFormatted = r.c?.[4]?.f || r.c?.[4]?.v || "";
  const rowDate = normalizeDate(dateFormatted);

if (rowDate && (rowDate in counts)) {
  counts[rowDate]++;
}


});


  const data = Object.values(counts);

  if (weeklyChart) weeklyChart.destroy();




 weeklyChart = new Chart(document.getElementById("weeklyChart"), {
  type: "bar",
  data: {
    labels,
    datasets: [
      {
        type: "bar",
        data,
        backgroundColor: "rgba(37,99,235,0.6)",
        borderRadius: 4,
        barThickness: 18
      },
      {
        type: "line",
        data: calculateTrend(data),
        borderColor: "#9ca3af",
        borderWidth: 2,
        tension: 0,
        pointRadius: 0,
        hidden: !showTrend
      }
    ]
  },
  options: {
    animation: false,
    maintainAspectRatio: true,
    aspectRatio: 4,
    plugins: { legend: { display: false } },
    scales: {
      x: {
        grid: { display: true, color: "rgba(0,0,0,0.04)", drawBorder: false },
        ticks: { color: "#9ca3af" }
      },
      y: {
        beginAtZero: true,
        grid: { color: "rgba(0,0,0,0.06)", borderDash: [4, 4], drawBorder: false },
        ticks: { color: "#9ca3af", precision: 0 }
      }
    }
  }
});


}
 function toggleStats() {
  const box = document.getElementById("statsContainer");
  const btn = document.getElementById("statsBtn");

  const isHidden = box.style.display === "none";

  box.style.display = isHidden ? "block" : "none";
  btn.innerText = isHidden ? " ×”×¡×ª×¨ ×¡×˜×˜×™×¡×˜×™×§×•×ª" : " ×”×¦×’ ×¡×˜×˜×™×¡×˜×™×§×•×ª";

  // ×× ×¤×•×ª×—×™× â€“ × ×•×•×“× ×©×”×’×¨×£ ××¢×•×“×›×Ÿ
  if (isHidden) {
    loadData();
  }
}



function loadData(ignoreFilter = false) {
  fetch(URL)
    .then(res => res.text())
    .then(text => {
      const json = JSON.parse(text.substring(47).slice(0, -2));
      const rows = json.table.rows || [];
      const tbody = document.querySelector("#tbl tbody");
      tbody.innerHTML = "";

      const selectedDate = document.getElementById("viewDate").value;
updateWeeklyChart(rows);

      rows.slice(1).forEach(r => {
        const status = r.c?.[1]?.v || "";
        // ×¤×™×œ×˜×¨: ×¨×§ OUT
if (showOnlyOut && status !== "OUT") return;

        const dateFormatted = r.c?.[4]?.f || r.c?.[4]?.v || "";
        const timeFormatted = r.c?.[5]?.f || r.c?.[5]?.v || "";

        const rowDate = normalizeDate(dateFormatted);

        if (!ignoreFilter && selectedDate) {
          if (!rowDate || rowDate !== selectedDate) return;
        }

        const tr = document.createElement("tr");
        tr.className = status;

        tr.innerHTML = `
          <td>${r.c?.[0]?.v || ""}</td>
          <td>${status}</td>
          <td>${r.c?.[2]?.v || ""}</td>
          <td>${r.c?.[3]?.v || ""}</td>
          <td>${dateFormatted}</td>
          <td>${timeFormatted}</td>
        `;
        tbody.appendChild(tr);
      });
    });
}

// ===== Clock =====
function updateDateTime() {
  const now = new Date();
  document.getElementById("datetime").innerText =
    now.toLocaleDateString("he-IL") + " | " + now.toLocaleTimeString("he-IL");
}
// ×‘×¨×™×¨×ª ××—×“×œ: ×”×™×•×
document.getElementById("viewDate").value =
  new Date().toISOString().split("T")[0];
  // ===== ×‘×¨×™×¨×ª ××—×“×œ ×œ×¡×˜×˜×™×¡×˜×™×§×•×ª: 7 ×™××™× ××—×¨×•× ×™× =====
const today = new Date();
const weekAgo = new Date();
weekAgo.setDate(today.getDate() - 6);

document.getElementById("statsFrom").value =
  weekAgo.toISOString().split("T")[0];

document.getElementById("statsTo").value =
  today.toISOString().split("T")[0];


// ×˜×¢×™× ×” ×¨××©×•× ×™×ª ×¢× ×¤×™×œ×˜×¨ ×©×œ ×”×™×•×
loadData();


setInterval(updateDateTime, 1000);
updateDateTime();

// ×˜×¢×™× ×” ×¨××©×•× ×™×ª
setInterval(() => {
  loadData(showOnlyOut); 
}, 10000);


function updateStatsRange() {
  fetch(URL)
    .then(res => res.text())
    .then(text => {
      const json = JSON.parse(text.substring(47).slice(0, -2));
      const rows = json.table.rows || [];
      updateWeeklyChart(rows);
    });
}
function toggleTrend() {
  showTrend = !showTrend;

  if (weeklyChart) {
    weeklyChart.data.datasets[1].hidden = !showTrend;
    weeklyChart.update();
  }

  // ××•×¤×¦×™×•× ×œ×™: ×œ×”×—×œ×™×£ ×˜×§×¡×˜ ×‘×›×¤×ª×•×¨ ×¢×¦××•
  const btn = document.querySelector('#statsContainer button.outline');
  if (btn) btn.innerText = showTrend ? "×”×¡×ª×¨ ×§×• ××’××”" : "×§×• ××’××”";
}
function toggleOutOnly() {
  showOnlyOut = !showOnlyOut;

  const btn = document.getElementById("outBtn");

  if (showOnlyOut) {
    btn.innerText = "×”×¦×’ ××ª ×›×œ ×”××™×¨×•×¢×™×";
    loadData(true);   // OUT ×‘×œ×‘×“, ×‘×œ×™ ×ª××¨×™×š
  } else {
    btn.innerText = "×”×¦×’ ××™×¨×•×¢×™× ×©×œ× ×—×–×¨×•";
    loadData(false);  // ×—×–×¨×” ×œ×“×™×¤×•×œ×˜ = ×”×™×•×
  }
}





</script>

  </div>

</html>
