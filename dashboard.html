<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<title>×“×©×‘×•×¨×“ ×¦×™×•×“</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#f3f4f6;
  --card:#ffffff;
  --primary:#1f2937;
  --secondary:#374151;
  --accent:#2563eb;
  --border:#e5e7eb;
}

body {
  margin:0;
  font-family: Arial, sans-serif;
  direction: rtl;
  background: var(--bg);
  color:#111827;
}

/* ===== Header ===== */
.header {
  background: var(--primary);
  color: white;
  padding: 16px 24px;
  display:flex;
  justify-content: space-between;
  align-items:center;
}

.header h1 {
  margin:0;
  font-size:20px;
  font-weight:600;
}

.datetime {
  font-size:14px;
  opacity:0.9;
}

/* ===== Page container ===== */
.container {
  padding: 24px 32px;
  width: 100%;
}




/* ===== Controls card ===== */
.controls {
  background: var(--card);
  border:1px solid var(--border);
  border-radius:10px;
  padding:16px;
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:20px;
  box-shadow:0 4px 10px rgba(0,0,0,0.04);
}

.controls label {
  font-size:14px;
  color:var(--secondary);
}

.controls input {
  padding:6px 10px;
  border:1px solid var(--border);
  border-radius:6px;
}

.controls button {
  background: var(--accent);
  color:white;
  border:none;
  border-radius:6px;
  padding:8px 14px;
  cursor:pointer;
  font-size:14px;
}

.controls button.secondary {
  background:#6b7280;
}

.controls button:hover {
  opacity:0.9;
}
.controls button.primary {
  background: var(--accent);
  box-shadow: 0 2px 4px rgba(37,99,235,0.15);
}

.controls button.secondary {
  background: #f3f4f6;
  color: #374151;
  border: 1px solid var(--border);
}

.controls button.outline {
  background: transparent;
  color: var(--secondary);
  border: 1px dashed var(--border);
}


/* ===== Table ===== */
.table-card {
  background: var(--card);
  border:1px solid var(--border);
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 4px 10px rgba(0,0,0,0.04);
}

table {
  width:100%;
  border-collapse: collapse;
}

th, td {
  padding:12px;
  border-bottom:1px solid var(--border);
  text-align:center;
  font-size:14px;
}

th {
  background:#f9fafb;
  color:#374151;
  font-weight:600;
}

tr:hover {
  background:#f3f4f6;
}

.IN { background:#ecfdf5; }
.OUT { background:#fef2f2; }

.footer-note {
  margin-top:10px;
  font-size:12px;
  color:#6b7280;
}
* {
  box-sizing: border-box;
}

</style>
</head>

<body>

<!-- ===== Header ===== -->
<div class="header">
  <h1>ğŸ“Š ×“×©×‘×•×¨×“ ×‘×§×¨×” â€“ ×¦×™×•×“</h1>
  <div class="datetime" id="datetime"></div>
</div>




  <!-- ===== Controls ===== -->
  <div class="controls">
  <label>×ª××¨×™×š ×œ×¦×¤×™×™×”:</label>
  <input type="date" id="viewDate">
  <button class="primary" onclick="loadData()">×¦×¤×”</button>
<button class="secondary" onclick="loadData(true)">×¨×¢× ×Ÿ</button>
<button class="outline" onclick="toggleStats()" id="statsBtn">×¡×˜×˜×™×¡×˜×™×§×•×ª</button>

</div>



  <!-- ===== Table ===== -->
  <div class="table-card">
    <table id="tbl">
      <thead>
        <tr>
          <th>××¡×³ ××¡××š</th>
          <th>×¡×˜×˜×•×¡</th>
          <th>×©× ×”××™×¨×•×¢</th>
          <th>×©× ×”×—×•×ª×</th>
          <th>×ª××¨×™×š</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="footer-note">
    × ×ª×•× ×™× ×‘×–××Ÿ ×××ª  
  </div>
   <div id="statsContainer" class="table-card" style="margin-top:20px; display:none;">
  <canvas id="weeklyChart" height="60"></canvas>
</div>

</div>

<script>
const GID = "0";
const URL = `https://docs.google.com/spreadsheets/d/1-FwT_TEBWPH-tEk1N3bi88S-9TukQ3iPJMl6l0ikDCI/gviz/tq?tqx=out:json&gid=${GID}`;

// dd/mm/yyyy â†’ yyyy-mm-dd
function normalizeDate(ddmmyyyy) {
  if (!ddmmyyyy || !ddmmyyyy.includes("/")) return null;
  const [dd, mm, yyyy] = ddmmyyyy.split("/");
  return `${yyyy}-${mm.padStart(2,"0")}-${dd.padStart(2,"0")}`;
}
let weeklyChart;

function updateWeeklyChart(rows) {
  const counts = {};
  const labels = [];

  // 7 ×™××™× ××—×•×¨×”
  for (let i = 6; i >= 0; i--) {
    const d = new Date();
    d.setDate(d.getDate() - i);
    const key = d.toISOString().split("T")[0];
    counts[key] = 0;
    labels.push(
  d.getDate().toString().padStart(2,"0") + "/" +
  (d.getMonth()+1).toString().padStart(2,"0")
);

  }

  rows.slice(1).forEach(r => {
    const status = r.c?.[1]?.v;
    if (status !== "OUT") return;

    const dateFormatted = r.c?.[4]?.f || r.c?.[4]?.v || "";
    const rowDate = normalizeDate(dateFormatted);
    if (rowDate in counts) counts[rowDate]++;
  });

  const data = Object.values(counts);

  if (weeklyChart) weeklyChart.destroy();

  weeklyChart = new Chart(document.getElementById("weeklyChart"), {
    type: "bar",
    data: {
      labels,
      datasets: [{
        label: "×”×•×¤×¢×•×ª ×©×™×¦××• (OUT)",
        data,
        borderColor: "#2563eb",
       
       backgroundColor: "rgba(37,99,235,0.7)",
borderColor: "#2563eb",
borderWidth: 1,
barThickness: 20

        
      }]
    },
    options: {
      animation: false,

      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true } }
    }
  });
}
 function toggleStats() {
  const box = document.getElementById("statsContainer");
  const btn = document.getElementById("statsBtn");

  const isHidden = box.style.display === "none";

  box.style.display = isHidden ? "block" : "none";
  btn.innerText = isHidden ? " ×”×¡×ª×¨ ×¡×˜×˜×™×¡×˜×™×§×•×ª" : " ×”×¦×’ ×¡×˜×˜×™×¡×˜×™×§×•×ª";

  // ×× ×¤×•×ª×—×™× â€“ × ×•×•×“× ×©×”×’×¨×£ ××¢×•×“×›×Ÿ
  if (isHidden) {
    loadData();
  }
}



function loadData(ignoreFilter = false) {
  fetch(URL)
    .then(res => res.text())
    .then(text => {
      const json = JSON.parse(text.substring(47).slice(0, -2));
      const rows = json.table.rows || [];
      const tbody = document.querySelector("#tbl tbody");
      tbody.innerHTML = "";

      const selectedDate = document.getElementById("viewDate").value;
updateWeeklyChart(rows);

      rows.slice(1).forEach(r => {
        const status = r.c?.[1]?.v || "";
        const dateFormatted = r.c?.[4]?.f || r.c?.[4]?.v || "";
        const rowDate = normalizeDate(dateFormatted);

        if (!ignoreFilter && selectedDate) {
          if (!rowDate || rowDate !== selectedDate) return;
        }

        const tr = document.createElement("tr");
        tr.className = status;

        tr.innerHTML = `
          <td>${r.c?.[0]?.v || ""}</td>
          <td>${status}</td>
          <td>${r.c?.[2]?.v || ""}</td>
          <td>${r.c?.[3]?.v || ""}</td>
          <td>${dateFormatted}</td>
        `;
        tbody.appendChild(tr);
      });
    });
}

// ===== Clock =====
function updateDateTime() {
  const now = new Date();
  document.getElementById("datetime").innerText =
    now.toLocaleDateString("he-IL") + " | " + now.toLocaleTimeString("he-IL");
}
// ×‘×¨×™×¨×ª ××—×“×œ: ×”×™×•×
document.getElementById("viewDate").value =
  new Date().toISOString().split("T")[0];

// ×˜×¢×™× ×” ×¨××©×•× ×™×ª ×¢× ×¤×™×œ×˜×¨ ×©×œ ×”×™×•×
loadData();


setInterval(updateDateTime, 1000);
updateDateTime();

// ×˜×¢×™× ×” ×¨××©×•× ×™×ª
setInterval(() => {
  loadData();
}, 10000);


</script>


</body>
</html>
